# 棉花糖和猫猫的小屋

一个简单的Java应用程序，支持日记记录和实时聊天功能。

## 功能特点

1. **日记记录**
   - 记录每日心情和想法
   - 支持添加标签
   - 按关键词和日期搜索日记

2. **实时聊天**
   - 支持两种连接模式：
     - **直接连接模式**：适用于同一局域网内的用户
     - **服务器连接模式**：适用于不同网络环境的用户
   - 消息历史记录保存
   - 在线用户列表（服务器模式）

## 系统要求

- Java 8 或更高版本
- JavaFX
- SQLite数据库

## 使用方法

### 安装和运行

1. 克隆或下载项目
2. 确保SQLite数据库路径正确（默认为`E:/sqlite/identifier.sqlite`）
3. 使用Maven构建项目：`mvn clean package`
4. 运行应用程序：`java -jar target/message-1.0-SNAPSHOT.jar`

### 聊天功能

#### 直接连接模式（同一局域网）

1. 启动应用程序后，选择"直接连接"模式
2. 在聊天界面中，可以看到自己的IP地址
3. 让聊天对象也启动应用程序，并选择"直接连接"模式
4. 在"对方IP"输入框中输入对方的IP地址，然后点击"连接"
5. 连接成功后，就可以开始聊天了

#### 服务器连接模式（不同网络环境）

要使用服务器连接模式，需要先部署聊天服务器：

1. 在具有公网IP的服务器上部署`ChatServer.java`
2. 确保服务器防火墙开放了8888端口
3. 修改`ChatService.java`中的`SERVER_HOST`为服务器的IP地址
4. 重新编译应用程序

然后：

1. 启动应用程序后，选择"服务器连接"模式
2. 应用程序会自动连接到聊天服务器
3. 在在线用户列表中选择要聊天的用户
4. 开始聊天

## 如果没有公网服务器

如果您没有公网服务器，可以使用内网穿透工具（如ngrok）将本地运行的服务器暴露到公网：

1. 下载并安装[ngrok](https://ngrok.com/)
2. 在本地运行`ChatServer.java`
3. 使用ngrok创建一个TCP隧道：`ngrok tcp 8888`
4. ngrok会提供一个公网地址和端口，例如：`tcp://0.tcp.ngrok.io:12345`
5. 修改`ChatService.java`中的`SERVER_HOST`为ngrok提供的地址（例如`0.tcp.ngrok.io`）
6. 修改`SERVER_PORT`为ngrok提供的端口（例如`12345`）
7. 重新编译应用程序

## 注意事项

- 数据库文件路径在`DBUtil.java`中设置，请确保该路径存在且有写入权限
- 服务器模式需要一个具有公网IP的服务器，或者使用内网穿透工具
- 直接连接模式只适用于同一局域网内的用户 